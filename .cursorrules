# DragonOS CI Dashboard 项目开发规范

## 项目概述
这是一个CI测试结果Dashboard系统，用于展示和管理DragonOS项目的CI测试结果。

## 技术栈

### 后端
- **语言**: Go 1.21+
- **Web框架**: Gin
- **ORM**: GORM
- **数据库**: MySQL 5.7+
- **数据库迁移**: golang-migrate/migrate
- **认证**: API Key (Bearer Token) + JWT (后台管理)
- **配置管理**: viper
- **文件存储**: 本地文件系统

### 前端
- **框架**: Vue 3 + Composition API
- **UI库**: TDesign Vue Next
- **路由**: Vue Router 4
- **状态管理**: Pinia
- **HTTP客户端**: Axios
- **构建工具**: Vite

## 项目结构

```
dragonos-ci-dashboard/
├── backend/                 # Go后端服务
│   ├── cmd/
│   │   └── server/         # 主程序入口
│   ├── internal/
│   │   ├── api/            # API路由和处理器
│   │   ├── models/         # 数据模型
│   │   ├── services/       # 业务逻辑层
│   │   ├── middleware/     # 中间件（认证、日志等）
│   │   ├── config/         # 配置管理
│   │   └── storage/        # 文件存储处理
│   ├── migrations/         # 数据库迁移文件
│   ├── pkg/                # 公共包
│   ├── go.mod
│   └── Dockerfile
├── frontend/               # Vue3前端
│   ├── src/
│   │   ├── views/          # 页面组件
│   │   ├── components/     # 通用组件
│   │   ├── api/            # API调用
│   │   ├── router/         # 路由配置
│   │   ├── stores/         # 状态管理
│   │   └── utils/          # 工具函数
│   ├── package.json
│   └── Dockerfile
├── docker-compose.yml      # Docker编排配置
├── .env.example            # 环境变量示例
└── README.md               # 项目文档
```

## 编码规范

### Go后端规范
1. **包命名**: 使用小写字母，简短有意义
2. **函数命名**: 使用驼峰命名，公开函数首字母大写
3. **错误处理**: 所有可能出错的操作都要检查错误
4. **日志**: 使用结构化日志，包含上下文信息
5. **API响应**: 统一使用JSON格式，包含code、message、data字段
6. **数据库操作**: 使用GORM，所有查询都要处理错误
7. **配置**: 使用环境变量，通过viper读取

### Vue前端规范
1. **组件命名**: 使用PascalCase，文件名与组件名一致
2. **组合式API**: 优先使用Composition API和`<script setup>`
3. **类型安全**: 使用TypeScript（如果启用）或JSDoc注释
4. **状态管理**: 使用Pinia，按功能模块划分store
5. **API调用**: 统一使用封装的axios实例，错误统一处理
6. **样式**: 使用TDesign组件，自定义样式使用scoped
7. **响应式**: 确保移动端适配

## API设计规范

### 接口路径
- 公开接口: `/api/v1/*`
- 受保护接口: `/api/v1/*` (需要API Key)
- 管理接口: `/api/v1/admin/*` (需要JWT认证)

### 请求/响应格式
```json
{
  "code": 200,
  "message": "success",
  "data": {}
}
```

### 错误码
- 200: 成功
- 400: 请求参数错误
- 401: 未授权
- 403: 禁止访问
- 404: 资源不存在
- 500: 服务器内部错误

## 数据库规范

1. **表命名**: 使用复数形式，小写字母，下划线分隔
2. **字段命名**: 使用小写字母，下划线分隔
3. **主键**: 统一使用`id`，类型为`BIGINT UNSIGNED AUTO_INCREMENT`
4. **时间字段**: 使用`created_at`、`updated_at`，类型为`DATETIME`
5. **索引**: 为常用查询字段创建索引
6. **外键**: 使用`project_id`、`test_run_id`等关联字段

## 安全规范

1. **API Key**: 使用bcrypt哈希存储，传输使用Bearer Token
2. **JWT**: 用于后台管理认证，设置合理的过期时间
3. **密码**: 使用bcrypt加密存储
4. **文件上传**: 验证文件类型和大小，防止路径遍历
5. **SQL注入**: 使用GORM的参数化查询
6. **CORS**: 配置允许的前端域名

## 测试规范

1. **单元测试**: 为关键业务逻辑编写单元测试
2. **集成测试**: 为API接口编写集成测试
3. **测试数据**: 使用测试数据库，避免污染生产数据

## 部署规范

1. **Docker**: 使用多阶段构建，减小镜像体积
2. **环境变量**: 敏感信息通过环境变量配置
3. **日志**: 输出到stdout/stderr，由容器编排工具收集
4. **健康检查**: 实现健康检查接口

## 开发流程

1. 从数据库迁移开始，确保数据结构正确
2. 实现数据模型和基础服务
3. 实现API接口
4. 实现前端页面和交互
5. 测试和调试
6. 编写文档

## 注意事项

1. 支持多项目扩展，使用`project_id`关联
2. 支持多测试类型扩展，使用`test_type`字段区分
3. 文件存储路径可配置，支持未来迁移到对象存储
4. API设计考虑扩展性，使用适配器模式处理不同测试类型

