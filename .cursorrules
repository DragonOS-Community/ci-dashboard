# DragonOS CI Dashboard 项目开发规范

## 项目概述
这是一个CI测试结果Dashboard系统，用于展示和管理DragonOS项目的CI测试结果。

## 技术栈

### 后端
- **语言**: Go 1.21+
- **Web框架**: Gin
- **ORM**: GORM
- **数据库**: MySQL 5.7+
- **数据库迁移**: golang-migrate/migrate
- **认证**: API Key (Bearer Token) + JWT (后台管理)
- **配置管理**: viper
- **文件存储**: 本地文件系统

### 前端
- **框架**: Vue 3 + Composition API
- **UI库**: TDesign Vue Next
- **路由**: Vue Router 4
- **状态管理**: Pinia
- **HTTP客户端**: Axios
- **构建工具**: Vite

## 项目结构

```
dragonos-ci-dashboard/
├── backend/                 # Go后端服务
│   ├── cmd/
│   │   └── server/         # 主程序入口
│   ├── internal/
│   │   ├── api/            # API路由和处理器
│   │   ├── models/         # 数据模型
│   │   ├── services/       # 业务逻辑层
│   │   ├── middleware/     # 中间件（认证、日志等）
│   │   ├── config/         # 配置管理
│   │   └── storage/        # 文件存储处理
│   ├── migrations/         # 数据库迁移文件
│   ├── pkg/                # 公共包
│   ├── go.mod
│   └── Dockerfile
├── frontend/               # Vue3前端
│   ├── src/
│   │   ├── views/          # 页面组件
│   │   ├── components/     # 通用组件
│   │   ├── api/            # API调用
│   │   ├── router/         # 路由配置
│   │   ├── stores/         # 状态管理
│   │   └── utils/          # 工具函数
│   ├── package.json
│   └── Dockerfile
├── docker-compose.yml      # Docker编排配置
├── .env.example            # 环境变量示例
└── README.md               # 项目文档
```

## 编码规范

### Go后端规范
1. **包命名**: 使用小写字母，简短有意义
2. **函数命名**: 使用驼峰命名，公开函数首字母大写
3. **错误处理**: 所有可能出错的操作都要检查错误
4. **日志**: 使用结构化日志，包含上下文信息
5. **API响应**: 统一使用JSON格式，包含code、message、data字段
6. **数据库操作**: 使用GORM，所有查询都要处理错误
7. **配置**: 使用环境变量，通过viper读取

### Vue前端规范
1. **组件命名**: 使用PascalCase，文件名与组件名一致
2. **组合式API**: 优先使用Composition API和`<script setup>`
3. **类型安全**: 使用TypeScript（如果启用）或JSDoc注释
4. **状态管理**: 使用Pinia，按功能模块划分store
5. **API调用**: 统一使用封装的axios实例，错误统一处理
6. **样式**: 使用TDesign组件，自定义样式使用scoped
7. **响应式**: 确保移动端适配

## API设计规范

### 接口路径
- 公开接口: `/api/v1/*`
- 受保护接口: `/api/v1/*` (需要API Key)
- 管理接口: `/api/v1/admin/*` (需要JWT认证)

### 请求/响应格式
```json
{
  "code": 200,
  "message": "success",
  "data": {}
}
```

### 错误码
- 200: 成功
- 400: 请求参数错误
- 401: 未授权
- 403: 禁止访问
- 404: 资源不存在
- 500: 服务器内部错误

## 数据库规范

1. **表命名**: 使用复数形式，小写字母，下划线分隔
2. **字段命名**: 使用小写字母，下划线分隔
3. **主键**: 统一使用`id`，类型为`BIGINT UNSIGNED AUTO_INCREMENT`
4. **时间字段**: 使用`created_at`、`updated_at`，类型为`DATETIME`
5. **索引**: 为常用查询字段创建索引
6. **外键**: 使用`project_id`、`test_run_id`等关联字段

## 安全规范

1. **API Key**: 使用bcrypt哈希存储，传输使用Bearer Token
2. **JWT**: 用于后台管理认证，设置合理的过期时间
3. **密码**: 使用bcrypt加密存储
4. **文件上传**: 验证文件类型和大小，防止路径遍历
5. **SQL注入**: 使用GORM的参数化查询
6. **CORS**: 配置允许的前端域名

## 测试规范

1. **单元测试**: 为关键业务逻辑编写单元测试
2. **集成测试**: 为API接口编写集成测试
3. **测试数据**: 使用测试数据库，避免污染生产数据

## 部署规范

1. **Docker**: 使用多阶段构建，减小镜像体积
2. **环境变量**: 敏感信息通过环境变量配置
3. **日志**: 输出到stdout/stderr，由容器编排工具收集
4. **健康检查**: 实现健康检查接口

## 开发流程

1. 从数据库迁移开始，确保数据结构正确
2. 实现数据模型和基础服务
3. 实现API接口
4. 实现前端页面和交互
5. 测试和调试
6. 编写文档

## 注意事项

1. 支持多项目扩展，使用`project_id`关联
2. 支持多测试类型扩展，使用`test_type`字段区分
3. 文件存储路径可配置，支持未来迁移到对象存储
4. API设计考虑扩展性，使用适配器模式处理不同测试类型



# 前端相关

## 六、响应式设计

### 1. 桌面端 (≥1200px)
- 侧边栏固定展开（240px）
- 顶部导航完整显示

### 2. 平板端 (768px - 1199px)
- 侧边栏可收缩（64px）
- 保持顶部导航

### 3. 移动端 (<768px)
- 侧边栏抽屉模式
- 简化面包屑显示
- 表格横向滚动

## 七、视觉设计规范（Figma 风格 - 白&黄配色）

### 1. 设计理念
采用 Figma 流行的简约卡片风格，以白色为主色调，搭配温暖的黄色作为强调色，营造现代、清爽、友好的界面氛围。

### 2. 主题色彩
- **主色（黄）**：#FCD34D → #F59E0B（渐变黄）
- **主色深色**：#D97706
- **背景色**：#FFFFFF（纯白）
- **次级背景**：#FAFAFA（极浅灰）
- **卡片背景**：#FFFFFF
- **边框色**：#E5E7EB（浅灰）
- **分割线**：#F3F4F6

### 3. 功能色彩
- **成功**：#10B981（翡翠绿）
- **警告**：#F59E0B（琥珀黄）
- **错误**：#EF4444（红）
- **信息**：#3B82F6（蓝）
- **文本主色**：#1F2937（深灰）
- **文本次色**：#6B7280（中灰）
- **文本辅助**：#9CA3AF（浅灰）

### 4. 卡片风格规范
```
┌─────────────────────────────────────────────┐
│  █ 卡片标题                                  │
│  ─────────────────────────────────────────   │
│                                             │
│  卡片内容区域                                │
│  • 圆角：12px                                │
│  • 阴影：0 1px 3px rgba(0,0,0,0.05)        │
│  • 内边距：24px                              │
│  • 悬停阴影：0 4px 12px rgba(0,0,0,0.08)   │
│                                             │
└─────────────────────────────────────────────┘
```

### 5. 按钮设计
```
主要按钮：
┌──────────────────┐
│  [🔍] 搜索        │  背景：#F59E0B  文字：白色
└──────────────────┘

次要按钮：
┌──────────────────┐
│  ⟲ 刷新           │  背景：白色  边框：#E5E7EB
└──────────────────┘

幽灵按钮：
┌──────────────────┐
│  查看详情          │  背景：透明  文字：#F59E0B
└──────────────────┘
```

### 6. 间距规范
- **页面边距**：32px
- **卡片间距**：24px
- **组件间距**：16px
- **表单项间距**：20px
- **文字行高**：1.6

### 7. 字体规范
- **页面标题**：24px/600（Semibold）
- **卡片标题**：18px/600（Semibold）
- **正文内容**：14px/400（Regular）
- **辅助文字**：12px/400（Regular）
- **数据展示**：28px/700（Bold）

### 8. 图标风格
- 使用线性图标（Outline）
- 图标尺寸：16px、20px、24px
- 颜色跟随文字色或使用主题色

### 9. 特殊元素
- **状态标签**：圆角 16px，内边距 4px 12px
- **徽章**：圆形，直径 8px
- **进度条**：圆角 4px，高度 8px
- **输入框**：圆角 8px，边框 1px，高度 40px

### 10. 动画效果
- **页面切换**：淡入淡出 200ms
- **卡片悬停**：阴影变化 150ms
- **按钮点击**：轻微缩放 100ms
- **数据加载**：骨架屏动画

### 11. 配色示例
```
Header 背景色：#FFFFFF
Sidebar 背景：#FAFAFA
主内容区背景：#F9FAFB
卡片背景：#FFFFFF
强调色按钮：#F59E0B
成功状态：#10B981
警告状态：#F59E0B
错误状态：#EF4444
```

## 八、交互设计

### 1. 加载状态
- 页面级：骨架屏
- 表格：加载动画
- 按钮：loading 状态

### 2. 反馈提示
- 成功：顶部提示 3秒
- 错误：顶部提示 5秒
- 确认：弹窗确认

### 3. 操作流程
- 创建：弹窗表单
- 编辑：内联编辑或弹窗
- 删除：二次确认
- 批量：选中后操作
